<?php

function handleDuplicateEntriesError($response, $exception)
{
  $errorText = str_replace(
    ['UNIQUE constraint failed: ', ' '],
    '',
    $exception->errorInfo[2],
  );

  prepareJsonResponse(
    $response,
    array_map(function ($item) {
      return strpos($item, '.') !== false
        ? explode('.', $item)[1]
        : explode('_', $item)[1];
    }, explode(',', $errorText)),
    'Duplicate entries',
    intval($exception->getCode()),
  );
}
