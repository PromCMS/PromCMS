<?php

namespace App\Controllers;

use DI\Container;
use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;

class UserProfile
{
    private $container;

    public function __construct(Container $container)
    {
        $this->container = $container;
    }

    public function getCurrent(ServerRequestInterface $request, ResponseInterface $response): ResponseInterface
    {
        $userId = $this->container->get('session')->get('user_id', false);

        if ($userId === false) return $response;

        $response->getBody()->write(json_encode(
            [
                <%# We know for sure that we call in prom users a Users internally. Its reserved by code generator when generating from config. %> 
                "data" => \Users::find('id', $userId)
            ]
        ));

        return $response->withHeader('Content-Type', 'application/json');
    }
}